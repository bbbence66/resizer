<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Batch Image Resizer</title>
    <link rel="stylesheet" href="./styles.css" />
    <!-- Third-party libraries loaded via CDN (kept client-side only) -->
    <!-- JSZip for creating downloadable ZIP archives -->
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js" defer></script>
    <!-- exifr for reading EXIF metadata (e.g., orientation) -->
    <script src="https://cdn.jsdelivr.net/npm/exifr@7.1.3/dist/full.umd.js" defer></script>
    <!-- piexifjs for injecting EXIF metadata (e.g., DPI) into JPEGs -->
    <script src="https://cdn.jsdelivr.net/npm/piexifjs@1.0.6/piexif.min.js" defer></script>
  </head>
  <body>
    <header class="app-header">
      <h1>Batch Image Resizer</h1>
      <p class="subtitle">Client-side batch conversion for product imagery</p>
    </header>

    <main class="app">
      <!-- Controls / Presets Sidebar -->
      <section class="controls">
        <div class="panel">
          <h2 style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
            <span>Presets</span>
            <button id="addPresetBtn" class="icon-btn" title="Create preset" aria-label="Create preset">+</button>
          </h2>
          <div class="field">
            <label>Saved presets</label>
            <div id="savedPresetsList" class="saved-list"></div>
            <small>Select one or more saved presets; selected ones will be used when processing.</small>
          </div>
          <div id="presets" hidden></div>
        </div>

          <div class="panel">
          <h2>Global Settings</h2>
          <div class="field">
            <label for="namingPattern">File naming pattern</label>
            <input id="namingPattern" type="text" value="{name}_{width}x{height}" />
            <small>Use placeholders: {name}, {index}, {preset}, {width}, {height}, {format}, {product}</small>
          </div>
          <div class="field">
            <label for="productName">Product name (for filename and JPEG metadata)</label>
            <input id="productName" type="text" placeholder="e.g. SKU-1234 Red Shoe" />
          </div>
          <div class="field">
            <label for="metaComment">Metadata comment (JPEG only)</label>
            <input id="metaComment" type="text" placeholder="Optional note (stored in EXIF ImageDescription)" />
          </div>
          <div class="field">
            <label for="dpi">DPI (JPEG only)</label>
            <input id="dpi" type="range" min="72" max="600" step="1" value="72" />
            <div class="range-value"><span id="dpiVal">72</span> dpi</div>
          </div>
          <div class="field">
            <label for="bgColor">Background color (for contain/flatten)</label>
            <input id="bgColor" type="color" value="#ffffff" />
          </div>
          <div class="field checkbox">
            <input id="preserveTransparency" type="checkbox" checked />
            <label for="preserveTransparency">Preserve transparency when possible (PNG/WebP/AVIF)</label>
          </div>
        </div>

        <div class="panel actions">
          <button id="processBtn" class="btn primary" disabled>Process & Download ZIP</button>
          <button id="clearBtn" class="btn">Clear Files</button>
        </div>
      </section>

      <!-- Workspace: Dropzone + Queue + Progress -->
      <section class="workspace">
        <div id="dropzone" class="dropzone">
          <input id="fileInput" type="file" accept="image/*" multiple />
          <p>Drop images here or click to select</p>
        </div>

        <div class="queue-header">
          <h2>Files</h2>
          <div class="right">
            <span id="fileCount">0 files</span>
          </div>
        </div>
        <ul id="fileList" class="file-list"></ul>

        <div id="progress" class="progress" hidden>
          <div class="progress-bar"><span id="progressBar" style="width:0%"></span></div>
          <div class="progress-label"><span id="progressText">0%</span></div>
        </div>
      </section>
    </main>

    <footer class="app-footer">
      <span>All processing happens locally in your browser. Safe to use with product imagery.</span>
    </footer>

    <!-- App scripts (ES modules) -->
    <div id="presetModal" class="modal" hidden>
      <div class="modal-backdrop" data-close></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3>Create preset</h3>
          <button class="icon-btn" data-close aria-label="Close">Ã—</button>
        </div>
        <div id="presetEditorContainer"></div>
      </div>
    </div>
    <script type="module" src="./src/app.js"></script>
  </body>
  </html>

